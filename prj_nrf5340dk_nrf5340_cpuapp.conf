#
# Copyright (c) 2019 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

CONFIG_BT_DEVICE_NAME="Nordic_Performance_Test"
CONFIG_BT=y
CONFIG_BT_SMP=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_CENTRAL=y
CONFIG_BT_MAX_CONN=5
CONFIG_BT_REMOTE_VERSION=y
CONFIG_BT_REMOTE_INFO=y

# rpmsg
# https://docs.zephyrproject.org/3.1.0/connectivity/bluetooth/bluetooth-arch.html?highlight=config_bt_ctlr
CONFIG_BT_RPMSG=y
CONFIG_IPC_SERVICE_BACKEND_RPMSG_WQ_STACK_SIZE=4096
CONFIG_IPC_SERVICE_BACKEND_RPMSG_NUM_ENDPOINTS_PER_INSTANCE=6
CONFIG_NUM_MBOX_ASYNC_MSGS=20
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048

CONFIG_BT_SCAN=y
CONFIG_BT_SCAN_FILTER_ENABLE=y
CONFIG_BT_SCAN_UUID_CNT=1

# add service
CONFIG_BT_GATT_CLIENT=y
CONFIG_BT_GATT_DM=y
CONFIG_BT_PERF_TEST=y

# add config update possibility
CONFIG_BT_USER_DATA_LEN_UPDATE=y
CONFIG_BT_USER_PHY_UPDATE=y
CONFIG_BT_GAP_AUTO_UPDATE_CONN_PARAMS=n
CONFIG_BT_DATA_LEN_UPDATE=y

# mtu settings
CONFIG_BT_ATT_PREPARE_COUNT=5
CONFIG_BT_L2CAP_TX_BUF_COUNT=5
CONFIG_BT_L2CAP_TX_MTU=498
CONFIG_BT_L2CAP_DYNAMIC_CHANNEL=y
CONFIG_BT_BUF_ACL_RX_COUNT=5
CONFIG_BT_BUF_ACL_TX_COUNT=5
CONFIG_BT_BUF_ACL_TX_SIZE=502
CONFIG_BT_BUF_ACL_RX_SIZE=502
CONFIG_BT_BUF_CMD_TX_COUNT=5
CONFIG_BT_BUF_EVT_RX_SIZE=255
CONFIG_BT_GATT_CACHING=y

## system
CONFIG_HEAP_MEM_POOL_SIZE=8192
# CONFIG_MAIN_STACK_SIZE=16384
# CONFIG_HEAP_MEM_POOL_SIZE=16384
# leds, spi cs and other gpio
CONFIG_GPIO=y
CONFIG_MPU_STACK_GUARD=y
CONFIG_THREAD_NAME=y
CONFIG_SCHED_MULTIQ=y
CONFIG_TICKLESS_KERNEL=y
CONFIG_BOOT_BANNER=n
CONFIG_PIPES=y

## serial
CONFIG_SERIAL=y
CONFIG_STDOUT_CONSOLE=y

## logger
CONFIG_LOG=y
#CONFIG_LOG_MODE_MINIMAL=y
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_CBPRINTF_NANO=y
CONFIG_LOG_MODE_DEFERRED=y
CONFIG_LOG_SPEED=y
CONFIG_LOG_BUFFER_SIZE=10240
CONFIG_LOG_PROCESS_THREAD_SLEEP_MS=1
CONFIG_LOG_ALWAYS_RUNTIME=y
CONFIG_LOG_BACKEND_FORMAT_TIMESTAMP=n
CONFIG_LOG_BACKEND_UART=n

## shell
CONFIG_SHELL=y          # add normal shell
CONFIG_SHELL_BACKEND_SERIAL=y
CONFIG_SHELL_METAKEYS=y # add ctrl+c

CONFIG_SHELL_BACKEND_SERIAL_LOG_MESSAGE_QUEUE_TIMEOUT=10
CONFIG_SHELL_BACKEND_SERIAL_LOG_MESSAGE_QUEUE_SIZE=256
CONFIG_SHELL_BACKEND_SERIAL_TX_RING_BUFFER_SIZE=8192
CONFIG_SHELL_BACKEND_SERIAL_RX_RING_BUFFER_SIZE=8192
CONFIG_SHELL_PROMPT_UART=":$ "
CONFIG_SHELL_LOG_BACKEND=y
CONFIG_SHELL_LOG_FORMAT_TIMESTAMP=n
CONFIG_SHELL_BACKEND_SERIAL_CHECK_DTR=n

# spi
# https://github.com/nrfconnect/sdk-zephyr/blob/main/drivers/spi/spi_nrfx_spim.c
# https://devzone.nordicsemi.com/f/nordic-q-a/70105/how-to-use-spi-interface-in-a-zephyr-sample-example
# https://devzone.nordicsemi.com/f/nordic-q-a/69034/nrf52840-spi-slave-configuration-event_handler
CONFIG_SPI=y
CONFIG_SPI_NRFX=y
CONFIG_NRFX_SPIM2=y

## shell
## console driver
CONFIG_NRFX_UARTE0=y


# # add tracing
# # https://blog.golioth.io/taking-the-next-step-debugging-with-segger-ozone-and-systemview-on-zephyr/
# CONFIG_TRACING=y
# CONFIG_TRACING_BACKEND_RAM=y

# CONFIG_LOG_BACKEND_RTT=n
# CONFIG_USE_SEGGER_RTT=y
# CONFIG_TRACING_BUFFER_SIZE=32768
# CONFIG_RAM_TRACING_BUFFER_SIZE=32768
# CONFIG_TRACING_PACKET_MAX_SIZE=512
# CONFIG_TRACING_CMD_BUFFER_SIZE=64
# CONFIG_TRACING_THREAD_WAIT_THRESHOLD=50
# CONFIG_TRACING_ASYNC=y
# CONFIG_TRACING_THREAD_STACK_SIZE=4096

# # use allow for faster data access
# # https://developer.arm.com/documentation/den0042/a/Tightly-Coupled-Memory
# CONFIG_SEGGER_SYSTEMVIEW=y
# CONFIG_SEGGER_SYSTEMVIEW_BOOT_ENABLE=n
# CONFIG_SEGGER_SYSVIEW_RTT_BUFFER_SIZE=32768

# ### debug
# CONFIG_THREAD_ANALYZER=y
# CONFIG_THREAD_ANALYZER_USE_LOG=y
# CONFIG_THREAD_ANALYZER_AUTO=y
# CONFIG_THREAD_ANALYZER_AUTO_INTERVAL=5
# CONFIG_THREAD_NAME=y

# clock settings
# https://github.com/zephyrproject-rtos/zephyr/issues/28469#issuecomment-704164283
# https://developer.nordicsemi.com/nRF_Connect_SDK/doc/latest/zephyr/kernel/services/timing/clocks.html
# https://devzone.nordicsemi.com/f/nordic-q-a/92297/increasing-cpu-clock-frequency-for-bl653
# CONFIG_NRF_RTC_TIMER=n
# CONFIG_CORTEX_M_SYSTICK=y
# CONFIG_SYS_CLOCK_HW_CYCLES_PER_SEC=64000000
# CONFIG_SYS_CLOCK_TICKS_PER_SEC=6400000

CONFIG_ADS129x_RINGBUFF=n
CONFIG_ADS129x_PIPE=y

CONFIG_BT_DEVICE_APPEARANCE=833
CONFIG_BT_MAX_CONN=2
CONFIG_BT_MAX_PAIRED=2

CONFIG_SHELL_BT_NUS=y
CONFIG_SHELL_BT_NUS_LOG_LEVEL_DBG=y
CONFIG_SHELL_BT_NUS_LOG_MESSAGE_QUEUE_SIZE=200
CONFIG_SHELL_BT_NUS_TX_RING_BUFFER_SIZE=220
CONFIG_SHELL_BT_NUS_RX_RING_BUFFER_SIZE=220
